# 读书家评论管理系统 - 部署说明

## 项目简介
读书家评论管理系统是一个简单的在线评论收集和管理平台，用户可以提交读书评论，管理员可以查看、筛选和导出评论数据。

## 系统架构
- **前端**: HTML + CSS + JavaScript（纯前端，无框架依赖）
- **后端**: Node.js + Express
- **数据库**: SQLite（轻量级，无需额外配置）
- **部署**: 支持各种云服务器平台

## 本地部署测试

### 1. 环境要求
- Node.js 14.0 或更高版本
- npm 包管理器

### 2. 安装步骤
```bash
# 1. 进入项目目录
cd 读书家

# 2. 安装依赖
npm install

# 3. 启动服务器
npm start
```

### 3. 访问测试
- 本地访问地址: http://localhost:3000
- 确认功能正常后可进行线上部署

## 云服务器部署指南

### 选择云服务器提供商
推荐以下几个性价比较高的选择：

#### 1. 阿里云ECS（推荐）
- **最低配置**: 1核2GB，1M带宽
- **价格**: 约60-100元/月
- **优势**: 国内访问速度快，中文支持好

#### 2. 腾讯云CVM
- **最低配置**: 1核2GB，1M带宽  
- **价格**: 约50-90元/月
- **优势**: 新用户优惠力度大

#### 3. 华为云ECS
- **最低配置**: 1核2GB，1M带宽
- **价格**: 约40-80元/月
- **优势**: 企业级稳定性好

#### 4. Vultr/DigitalOcean（海外）
- **最低配置**: 1GB内存，25GB SSD
- **价格**: 约$5-6/月（约35-40元/月）
- **优势**: 价格便宜，但国内访问可能较慢

### 服务器购买步骤

#### 以阿里云为例：

1. **注册账号**
   - 访问 https://www.aliyun.com
   - 注册账号并完成实名认证

2. **购买ECS实例**
   - 选择产品：云服务器ECS
   - 实例规格：1核2GB（入门级足够）
   - 镜像：Ubuntu 20.04 LTS 或 CentOS 8
   - 网络：分配公网IP
   - 安全组：开放22(SSH)、80(HTTP)、3000(应用)端口
   - 购买时长：建议先买1个月测试

3. **获取服务器信息**
   - 公网IP地址
   - SSH登录用户名和密码

## 服务器环境配置

### 1. 连接服务器
```bash
# Windows用户可以使用PuTTY或Windows Terminal
ssh root@你的服务器IP地址
```

### 2. 安装Node.js
```bash
# Ubuntu/Debian系统
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# CentOS/RHEL系统  
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo yum install -y nodejs

# 验证安装
node --version
npm --version
```

### 3. 安装PM2（进程管理器）
```bash
npm install -g pm2
```

### 4. 配置防火墙
```bash
# Ubuntu系统
sudo ufw allow 22
sudo ufw allow 80
sudo ufw allow 3000
sudo ufw enable

# CentOS系统
sudo firewall-cmd --permanent --add-port=22/tcp
sudo firewall-cmd --permanent --add-port=80/tcp  
sudo firewall-cmd --permanent --add-port=3000/tcp
sudo firewall-cmd --reload
```

## 上传项目文件

### 方法1: 使用SCP上传
```bash
# 在本地电脑执行（将文件上传到服务器）
scp -r 读书家/ root@你的服务器IP:/home/
```

### 方法2: 使用Git
```bash
# 在服务器上执行
cd /home
git clone 你的项目仓库地址
```

### 方法3: 手动上传
使用FTP工具（如FileZilla）将项目文件上传到服务器

## 启动应用

### 1. 安装项目依赖
```bash
cd /home/读书家
npm install
```

### 2. 测试运行
```bash
npm start
```

### 3. 使用PM2守护进程运行
```bash
# 启动应用
pm2 start server.js --name dushujia

# 设置开机自启
pm2 startup
pm2 save

# 查看应用状态
pm2 status

# 查看日志
pm2 logs dushujia
```

## 域名和SSL配置（可选）

### 1. 购买域名
- 在阿里云、腾讯云或GoDaddy等服务商购买域名
- 将域名解析到你的服务器IP地址

### 2. 配置Nginx反向代理
```bash
# 安装Nginx
sudo apt-get install nginx  # Ubuntu
sudo yum install nginx      # CentOS

# 配置文件
sudo nano /etc/nginx/sites-available/dushujia
```

Nginx配置内容：
```nginx
server {
    listen 80;
    server_name 你的域名.com;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

```bash
# 启用配置
sudo ln -s /etc/nginx/sites-available/dushujia /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

### 3. 配置SSL证书（Let's Encrypt免费证书）
```bash
# 安装Certbot
sudo apt-get install certbot python3-certbot-nginx

# 获取证书
sudo certbot --nginx -d 你的域名.com

# 设置自动续期
sudo crontab -e
# 添加以下行：
0 12 * * * /usr/bin/certbot renew --quiet
```

## 访问测试

### 通过IP访问
- 直接访问：http://你的服务器IP:3000

### 通过域名访问（如已配置）
- HTTP访问：http://你的域名.com
- HTTPS访问：https://你的域名.com

## 数据备份

### 1. 定期备份数据库
```bash
# 创建备份脚本
nano /home/backup.sh
```

备份脚本内容：
```bash
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
cp /home/读书家/comments.db /home/backups/comments_$DATE.db
# 保留最近30天的备份
find /home/backups -name "comments_*.db" -mtime +30 -delete
```

```bash
# 设置执行权限
chmod +x /home/backup.sh

# 设置定时任务（每天备份）
crontab -e
# 添加：0 2 * * * /home/backup.sh
```

### 2. 下载备份到本地
```bash
scp root@服务器IP:/home/backups/comments_*.db ./
```

## 维护命令

### 查看应用状态
```bash
pm2 status
pm2 logs dushujia
```

### 重启应用
```bash
pm2 restart dushujia
```

### 更新应用
```bash
cd /home/读书家
git pull  # 如果使用Git
pm2 restart dushujia
```

### 查看系统资源
```bash
htop      # 查看CPU和内存使用情况
df -h     # 查看磁盘使用情况
```

## 常见问题解决

### 1. 端口被占用
```bash
# 查看端口占用
sudo lsof -i :3000
# 杀死进程
sudo kill -9 进程号
```

### 2. 权限问题
```bash
# 修改文件权限
sudo chown -R root:root /home/读书家
sudo chmod -R 755 /home/读书家
```

### 3. 内存不足
```bash
# 创建Swap分区
sudo fallocate -l 1G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
```

## 成本估算

### 基础配置年费用
- **云服务器**: 60-100元/月 × 12 = 720-1200元/年
- **域名**: 50-100元/年（可选）
- **总计**: 约800-1300元/年

### 优化建议
1. 选择年付可享受更多折扣
2. 关注云服务商的新用户活动
3. 如果访问量不大，可以选择最低配置

## 支持和维护

系统部署完成后，建议：
1. 定期检查服务器运行状态
2. 及时备份重要数据
3. 关注系统安全更新
4. 监控磁盘空间使用情况

---

**注意事项**：
- 请保管好服务器登录密码和相关配置信息
- 建议定期更换服务器密码
- 对于生产环境，建议配置更详细的安全策略
- 如遇到技术问题，可以咨询云服务商技术支持